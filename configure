#!/bin/bash
# Created by: WestleyR
# email: westleyr@nym.hush.com
# Date: Dec 20, 2019
# https://github.com/WestleyR/ssum
# Version-1.0.0
#
# The Clear BSD License
#
# Copyright (c) 2019 WestleyR
# All rights reserved.
#
# This software is licensed under a Clear BSD License.
#

set -e

# Default settings
prefix="${HOME}/.local"
cc="gcc"
option_rpath=0
option_without_library=0

print_usage() {
  echo "Usage: ./install.sh [--prefix /non/root/location]"
  echo ""
  echo "Note: there must be a space after the --prefix"
  echo ""
  echo "Options:"
  echo "  -p, --prefix /path/to/install  specify a prefix to install"
  echo "  --use-rpath                    use rpath when linking library"
  echo "  --without-library              dont install/use the shared library"
  echo ""
  exit 0
}

while [[ $# -gt 0 ]]; do
  option="$1"
  case $option in
    -p|--prefix)
      if [ -z $2 ]; then
        echo "prefix flag but no value"
        exit 1
      fi
      prefix="$2"
      shift
      shift
      ;;
    --use-rpath)
      option_rpath=1
      shift
      ;;
    --without-library)
      option_without_library=1
      shift
      ;;
    -h|--help)
      print_usage
      exit 0
      ;;
    *)
      echo "E: unknown argument: ${option}"
      exit 22
      ;;
  esac
done

echo "Prefix=${prefix}"

if [[ $option_rpath -eq 1 ]]; then
  echo "Using rpath"
fi

if [[ $option_without_library -eq 1 ]]; then
  echo "Not using library"
fi

echo "Building Makefile..."

cat << EOF > Makefile
# Created by: WestleyR
# email: westleyr@nym.hush.com
# Date: Dec 20, 2019
# https://github.com/WestleyR/ssum
# Version-2.0.0
#
# The Clear BSD License
#
# Copyright (c) 2019 WestleyR
# All rights reserved.
#
# This software is licensed under a Clear BSD License.
#

#
# This Makefile was generated by a configure script.
#
# Do not edit
#

CC = ${cc}
CFLAGS = -Wall

TARGET = ssum
LIB = libssum.1.so

# Default prefix
PREFIX = ${prefix}

EOF

cat Makefile.in >> Makefile

echo "Done."

# vim: tabstop=2 shiftwidth=2 expandtab
